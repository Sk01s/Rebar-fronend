import{R as x,r as m,j as F,u as W}from"./index-34aaf63e.js";import{a as i,s as T,b as Q,c as q,d as B,e as G,U as S,A as d,f,K as j,O as H}from"./firebase-config-cf75009f.js";const _=x.createContext();function X(c,l){return q(i,c,l).catch(g=>g.message)}function Y(){B(i)}function k(){return m.useContext(_)}function Z({children:c}){const[l,g]=m.useState();function p(h,u,s){return G(i,h,u).then(a=>(fetch("https://tech-mode-backend.app/payment/create-customer",{body:JSON.stringify({userId:i.currentUser.uid,email:h}),method:"POST",headers:{"Content-Type":"application/json"}}),T(i.currentUser),C(i.currentUser),P(i.currentUser),U(i.currentUser),a)).catch(a=>{throw console.log(a),s(a.message.match(/:.+\(/)[0].slice(1,-1)),a})}function b(){const h=setInterval(()=>{var u,s;(s=(u=i)==null?void 0:u.currentUser)==null||s.reload().then(a=>{i.currentUser.emailVerified&&(g(i.currentUser),clearInterval(h))})},1e3)}m.useEffect(()=>{const h=i.onAuthStateChanged(u=>(g(u),h))});const v={auth:i,signout:Y,login:X,signup:p,currentUser:l,sendEmailVerification:T,sendPasswordResetEmail:Q,checkForVerifiction:b};return F(_.Provider,{value:v,children:c})}const st=Object.freeze(Object.defineProperty({__proto__:null,Authenticator:Z,useAuth:k},Symbol.toStringTag,{value:"Module"})),E=x.createContext();function tt(){return m.useContext(E)}async function C(c){await S(d(f,"address",c.uid),{address:[]})}async function P(c){await S(d(f,"cart",c.uid),{list:[]})}async function U(c){await S(d(f,"favorite",c.uid),{list:[]})}function et({children:c}){const[l,g]=m.useState({list:[]}),[p,b]=m.useState({list:[]}),[v,h]=m.useState({list:[]}),u=W(),{currentUser:s}=k();async function a(t){return(await H(d(f,t,s==null?void 0:s.uid))).data()}async function z(t){const{firstname:r,lastname:e,country:n,state:w,street:o,city:O,zipcode:I}=t,{address:A}=await a("address");A==null||A.filter(y=>!(y.firstname===r&&y.lastname===e&&y.country===n&&y.state===w&&y.street===o&&y.city===O&&y.zipcode===I)),A.push({firstname:r,lastname:e,country:n,city:O,state:w,street:o,zipcode:I}),await S(d(f,"address",s.uid),{address:A},{merge:!0})}async function M(t){const e=await(await fetch("https://tech-mode-backend.app/payment/create-checkout-session",{body:JSON.stringify({userId:s.uid,items:t}),method:"POST",headers:{"Content-Type":"application/json"}})).json(),{url:n}=e;window.location=n}async function N(t=Number,r){let{list:e}=await a("cart");e=e.map(n=>(n==null?void 0:n.directory)===r?{...n,quantity:t}:n),b({list:e}),await S(d(f,"cart",s.uid),{list:e},{merge:!0})}async function V(t){let{list:r}=await a("cart");r=r.filter(e=>e.directory!==t),b({list:r}),await j(d(f,"cart",s.uid),{list:r})}async function D(t,r){if(r<1)return;s===null&&u("/Tech-Mode/signup");let{list:e}=await a("cart"),n;function w(o){e=e.filter(O=>O.directory!==o)}e.forEach(o=>{if(n!==!0){if(o.directory===t&&parseInt(o.quantity)!==parseInt(r))return w(o.directory);if(o.directory===t&&parseInt(o.quantity)===parseInt(r))return n=!0;n=!1}}),!n&&(e.push({quantity:r,directory:t}),b({list:e}),await j(d(f,"cart",s.uid),{list:e},{merge:!0}))}async function R(t){s===null&&u("/Tech-Mode/signup");const r=await a("favorite");let e,n;return r.list.includes(t)?(e=r.list.filter(w=>w!==t),n=!1):(r.list.push(t),e=r.list,n=!0),g({list:e}),await S(d(f,"favorite",s.uid),{list:e},{merge:!0}),n}async function $(){if((l==null?void 0:l[0])===void 0){const t=await a("favorite");return t===void 0?U():t.list}return l}async function J(){if((p==null?void 0:p[0])===void 0){const t=await a("cart");return t===void 0?P():t.list}return p}async function K(){if((v==null?void 0:v[0])===void 0){const t=await a("address");return t===void 0?C():(h(t.address),t.address)}return v}const L={createCart:P,createAddress:C,createFavList:U,addFavorite:R,addToCart:D,addAddress:z,checkout:M,getFavProducts:$,getCartProducts:J,getAddress:K,removeCartProduct:V,setQuanitiyDb:N};return F(E.Provider,{value:L,children:c})}const at=Object.freeze(Object.defineProperty({__proto__:null,SetOut:et,createAddress:C,createCart:P,createFavList:U,useSetOut:tt},Symbol.toStringTag,{value:"Module"}));export{st as A,at as S,tt as a,k as u};
