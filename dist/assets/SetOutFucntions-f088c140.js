import{R as F,r as O,j as J,u as Q}from"./index-f7c5f2e7.js";import{a as l,s as x,b as B,c as G,d as H,e as X,U as C,A as g,f as h,K as E,O as Y}from"./firebase-config-409fc865.js";const _=F.createContext();function Z(f,p){return G(l,f,p).catch(b=>b.message)}function q(){H(l)}function k(){return O.useContext(_)}function tt({children:f}){const[p,b]=O.useState();function I(S,v,o){return X(l,S,v).then(c=>(fetch("https://rebar-backend.app/payment/create-customer",{body:JSON.stringify({userId:l.currentUser.uid,email:S}),method:"POST",headers:{"Content-Type":"application/json"}}),x(l.currentUser),j(l.currentUser),U(l.currentUser),N(l.currentUser),c)).catch(c=>{throw o(c.message.match(/:.+\(/)[0].slice(1,-1)),c})}function P(){const S=setInterval(()=>{var v,o;(o=(v=l)==null?void 0:v.currentUser)==null||o.reload().then(c=>{l.currentUser.emailVerified&&(b(l.currentUser),clearInterval(S))})},1e3)}O.useEffect(()=>{const S=l.onAuthStateChanged(v=>(b(v),S))});const A={auth:l,signout:q,login:Z,signup:I,currentUser:p,sendEmailVerification:x,sendPasswordResetEmail:B,checkForVerifiction:P};return J(_.Provider,{value:A,children:f})}const at=Object.freeze(Object.defineProperty({__proto__:null,Authenticator:tt,useAuth:k},Symbol.toStringTag,{value:"Module"})),T=F.createContext();function et(){return O.useContext(T)}async function j(f){await C(g(h,"address",f.uid),{address:[]})}async function U(f){await C(g(h,"cart",f.uid),{list:[]})}async function N(f){await C(g(h,"favorite",f.uid),{list:[]})}function rt({children:f}){const[p,b]=O.useState({list:[]}),[I,P]=O.useState({list:[]}),[A,S]=O.useState({list:[]}),v=Q(),{currentUser:o}=k();async function c(t,n){let e;return o==null?e=JSON.parse(localStorage.getItem(t)):e=(await Y(g(h,t,o==null?void 0:o.uid))).data()[n],e}async function d(t){const{firstname:n,lastname:e,country:a,state:m,street:w,city:u,zipcode:s}=t;if(o==null){let i=JSON.parse(localStorage.getItem("address"))||[];i=i==null?void 0:i.filter(r=>!((r==null?void 0:r.firstname)===n&&(r==null?void 0:r.lastname)===e&&(r==null?void 0:r.country)===a&&(r==null?void 0:r.state)===m&&(r==null?void 0:r.street)===w&&(r==null?void 0:r.city)===u&&(r==null?void 0:r.zipcode)===s)),i.push({firstname:n,lastname:e,country:a,city:u,state:m,street:w,zipcode:s}),localStorage.setItem("address",JSON.stringify(i));return}let{address:y}=await c("address");y=y==null?void 0:y.filter(i=>!(i.firstname===n&&i.lastname===e&&i.country===a&&i.state===m&&i.street===w&&i.city===u&&i.zipcode===s)),y.push({firstname:n,lastname:e,country:a,city:u,state:m,street:w,zipcode:s}),await C(g(h,"address",o.uid),{address:y},{merge:!0})}async function z(t){const e=await(await fetch("https://rebar-backend.app/payment/create-checkout-session",{body:JSON.stringify({userId:o.uid,items:t}),method:"POST",headers:{"Content-Type":"application/json"}})).json(),{url:a}=e;window.location=a}async function V(t=Number,n){let{list:e}=await c("cart");e=e.map(a=>(a==null?void 0:a.directory)===n?{...a,quantity:t}:a),P({list:e}),await C(g(h,"cart",o.uid),{list:e},{merge:!0})}async function D(t){let n=await c("cart","list");n=n.filter(e=>e.directory!==t),P({list:n}),o==null&&localStorage.setItem("cart",JSON.stringify(n)),await E(g(h,"cart",o.uid),{list:n})}async function R(t,n,e){if(n<1)return;if(o===null){let u=function(i){s=s.filter(r=>r.directory!==i)},s=JSON.parse(localStorage.getItem("cart"));s==null&&(s=[]);let y;if(s.forEach(i=>{if(y!==!0){if(i.directory===t){if(parseInt(i.quantity)!==parseInt(n))return u(i.directory);Object.keys(i.options).map(r=>{if(i.options[r]!==e[r])return u(i.directory)})}if(i.directory===t&&parseInt(i.quantity)===parseInt(n)&&!Object.keys(i.options).map(r=>{if(i.options[r]!==e[r])return!1}).includes(!1))return y=!0;y=!1}}),y)return;s.push({quantity:n,directory:t,options:e}),P({CartProduct:s}),localStorage.setItem("cart",JSON.stringify(s))}let{list:a}=await c("cart"),m;function w(u){a=a.filter(s=>s.directory!==u)}a.forEach(u=>{if(m!==!0){if(u.directory===t){if(parseInt(u.quantity)!==parseInt(n))return w(u.directory);Object.keys(u.options).map(s=>{if(u.options[s]!==e[s])return w(u.directory)})}if(u.directory===t&&parseInt(u.quantity)===parseInt(n)&&!Object.keys(u.options).map(s=>{if(u.options[s]!==e[s])return!1}).includes(!1))return m=!0;m=!1}}),!m&&(a.push({quantity:n,directory:t,options:e}),P({list:a}),await E(g(h,"cart",o.uid),{list:a},{merge:!0}))}async function $(t){o===null&&v("/signup");const n=await c("favorite");let e,a;return n.list.includes(t)?(e=n.list.filter(m=>m!==t),a=!1):(n.list.push(t),e=n.list,a=!0),b({list:e}),await C(g(h,"favorite",o.uid),{list:e},{merge:!0}),a}async function K(){if((p==null?void 0:p[0])===void 0){const t=await c("favorite");return t===void 0?N():t.list}return p}async function L(){if((I==null?void 0:I[0])===void 0){const t=await c("cart","list");return t===void 0?U():t}return I}async function M(){if((A==null?void 0:A[0])===void 0){const t=await c("address","address");return console.log(t),t===void 0?j():(S(t),t)}return A}const W={createCart:U,createAddress:j,createFavList:N,addFavorite:$,addToCart:R,addAddress:d,checkout:z,getFavProducts:K,getCartProducts:L,getAddress:M,removeCartProduct:D,setQuanitiyDb:V};return J(T.Provider,{value:W,children:f})}const st=Object.freeze(Object.defineProperty({__proto__:null,SetOut:rt,createAddress:j,createCart:U,createFavList:N,useSetOut:et},Symbol.toStringTag,{value:"Module"}));export{at as A,st as S,et as a,k as u};
