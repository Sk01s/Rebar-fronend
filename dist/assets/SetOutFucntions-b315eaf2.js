import{R as F,r as v,j as _,u as W}from"./index-9fcefab8.js";import{a as u,s as I,b as Q,c as q,d as B,e as G,U as S,A as d,f as y,K as x,O as H}from"./firebase-config-409fc865.js";const k=F.createContext();function X(c,h){return q(u,c,h).catch(g=>g.message)}function Y(){B(u)}function E(){return v.useContext(k)}function Z({children:c}){const[h,g]=v.useState();function w(m,f,s){return G(u,m,f).then(i=>(fetch("https://rebar-backend.app/payment/create-customer",{body:JSON.stringify({userId:u.currentUser.uid,email:m}),method:"POST",headers:{"Content-Type":"application/json"}}),I(u.currentUser),P(u.currentUser),U(u.currentUser),j(u.currentUser),i)).catch(i=>{throw s(i.message.match(/:.+\(/)[0].slice(1,-1)),i})}function O(){const m=setInterval(()=>{var f,s;(s=(f=u)==null?void 0:f.currentUser)==null||s.reload().then(i=>{u.currentUser.emailVerified&&(g(u.currentUser),clearInterval(m))})},1e3)}v.useEffect(()=>{const m=u.onAuthStateChanged(f=>(g(f),m))});const b={auth:u,signout:Y,login:X,signup:w,currentUser:h,sendEmailVerification:I,sendPasswordResetEmail:Q,checkForVerifiction:O};return _(k.Provider,{value:b,children:c})}const st=Object.freeze(Object.defineProperty({__proto__:null,Authenticator:Z,useAuth:E},Symbol.toStringTag,{value:"Module"})),T=F.createContext();function tt(){return v.useContext(T)}async function P(c){await S(d(y,"address",c.uid),{address:[]})}async function U(c){await S(d(y,"cart",c.uid),{list:[]})}async function j(c){await S(d(y,"favorite",c.uid),{list:[]})}function et({children:c}){const[h,g]=v.useState({list:[]}),[w,O]=v.useState({list:[]}),[b,m]=v.useState({list:[]}),f=W(),{currentUser:s}=E();async function i(t){return(await H(d(y,t,s==null?void 0:s.uid))).data()}async function z(t){const{firstname:e,lastname:r,country:n,state:l,street:A,city:a,zipcode:o}=t,{address:C}=await i("address");C==null||C.filter(p=>!(p.firstname===e&&p.lastname===r&&p.country===n&&p.state===l&&p.street===A&&p.city===a&&p.zipcode===o)),C.push({firstname:e,lastname:r,country:n,city:a,state:l,street:A,zipcode:o}),await S(d(y,"address",s.uid),{address:C},{merge:!0})}async function D(t){const r=await(await fetch("https://rebar-backend.app/payment/create-checkout-session",{body:JSON.stringify({userId:s.uid,items:t}),method:"POST",headers:{"Content-Type":"application/json"}})).json(),{url:n}=r;window.location=n}async function N(t=Number,e){let{list:r}=await i("cart");r=r.map(n=>(n==null?void 0:n.directory)===e?{...n,quantity:t}:n),O({list:r}),await S(d(y,"cart",s.uid),{list:r},{merge:!0})}async function V(t){let{list:e}=await i("cart");e=e.filter(r=>r.directory!==t),O({list:e}),await x(d(y,"cart",s.uid),{list:e})}async function R(t,e,r){if(e<1)return;s===null&&f("/signup");let{list:n}=await i("cart"),l;function A(a){n=n.filter(o=>o.directory!==a)}n.forEach(a=>{if(l!==!0){if(a.directory===t){if(parseInt(a.quantity)!==parseInt(e))return A(a.directory);Object.keys(a.options).map(o=>{if(a.options[o]!==r[o])return A(a.directory)})}if(a.directory===t&&parseInt(a.quantity)===parseInt(e)&&!Object.keys(a.options).map(o=>{if(a.options[o]!==r[o])return!1}).includes(!1))return l=!0;l=!1}}),!l&&(n.push({quantity:e,directory:t,options:r}),O({list:n}),await x(d(y,"cart",s.uid),{list:n},{merge:!0}))}async function $(t){s===null&&f("/signup");const e=await i("favorite");let r,n;return e.list.includes(t)?(r=e.list.filter(l=>l!==t),n=!1):(e.list.push(t),r=e.list,n=!0),g({list:r}),await S(d(y,"favorite",s.uid),{list:r},{merge:!0}),n}async function J(){if((h==null?void 0:h[0])===void 0){const t=await i("favorite");return t===void 0?j():t.list}return h}async function K(){if((w==null?void 0:w[0])===void 0){const t=await i("cart");return t===void 0?U():t.list}return w}async function L(){if((b==null?void 0:b[0])===void 0){const t=await i("address");return t===void 0?P():(m(t.address),t.address)}return b}const M={createCart:U,createAddress:P,createFavList:j,addFavorite:$,addToCart:R,addAddress:z,checkout:D,getFavProducts:J,getCartProducts:K,getAddress:L,removeCartProduct:V,setQuanitiyDb:N};return _(T.Provider,{value:M,children:c})}const at=Object.freeze(Object.defineProperty({__proto__:null,SetOut:et,createAddress:P,createCart:U,createFavList:j,useSetOut:tt},Symbol.toStringTag,{value:"Module"}));export{st as A,at as S,tt as a,E as u};
